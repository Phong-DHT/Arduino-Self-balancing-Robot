# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'form.ui'
#
# Created by: PyQt5 UI code generator 5.15.9, Dang Huu Tuan Phong - 21151476 (LycoriS)
#
# WARNING: Any manual changes made to this file will be lost when pyuic5 is
# run again.  Do not edit this file unless you know what you are doing.

#import numpy as np
#import matplotlib.pyplot as plt
import time
import serial.tools.list_ports
import threading
import numpy as np
from PyQt5 import QtCore, QtGui, QtWidgets
from PyQt5.QtWidgets import QApplication, QMainWindow, QVBoxLayout, QWidget
from matplotlib.backends.backend_qt5agg import FigureCanvasQTAgg as FigureCanvas
from matplotlib.figure import Figure
from PyQt5.QtCore import Qt, QThread, pyqtSignal, QTimer
from itertools import count



class Ui_MainWindow(object):
    def setupUi(self, MainWindow):
        MainWindow.setObjectName("MainWindow")
        MainWindow.setWindowModality(QtCore.Qt.ApplicationModal)
        MainWindow.resize(1084, 841)
        MainWindow.setMinimumSize(QtCore.QSize(1084, 841))
        MainWindow.setMaximumSize(QtCore.QSize(1084, 841))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(12)
        font.setBold(False)
        font.setItalic(False)
        font.setWeight(50)
        MainWindow.setFont(font)
        MainWindow.setContextMenuPolicy(QtCore.Qt.DefaultContextMenu)
        MainWindow.setStatusTip("")
        MainWindow.setIconSize(QtCore.QSize(10, 30))
        MainWindow.setToolButtonStyle(QtCore.Qt.ToolButtonIconOnly)
        MainWindow.setAnimated(False)
        MainWindow.setTabShape(QtWidgets.QTabWidget.Rounded)
        MainWindow.setDockNestingEnabled(False)
        MainWindow.setDockOptions(QtWidgets.QMainWindow.AllowTabbedDocks)
        self.centralwidget = QtWidgets.QWidget(MainWindow)
        self.centralwidget.setObjectName("centralwidget")
        self.Terminal = QtWidgets.QGroupBox(self.centralwidget)
        self.Terminal.setGeometry(QtCore.QRect(10, 10, 321, 191))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(8)
        font.setBold(False)
        font.setItalic(False)
        font.setWeight(50)
        self.Terminal.setFont(font)
        self.Terminal.setInputMethodHints(QtCore.Qt.ImhNone)
        self.Terminal.setObjectName("Terminal")
        self.Bdbox = QtWidgets.QComboBox(self.Terminal)
        self.Bdbox.setGeometry(QtCore.QRect(10, 50, 101, 22))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(8)
        font.setBold(False)
        font.setItalic(False)
        font.setWeight(50)
        self.Bdbox.setFont(font)
        self.Bdbox.setObjectName("Bdbox")
        self.Bdbox.addItem("")
        self.Bdbox.addItem("")
        self.Bdbox.addItem("")
        self.Bdbox.addItem("")
        self.Bdbox.addItem("")
        self.Bdbox.addItem("")
        self.Bdbox.addItem("")
        self.Bdbox.addItem("")
        self.Baudrate = QtWidgets.QLabel(self.Terminal)
        self.Baudrate.setGeometry(QtCore.QRect(10, 30, 81, 16))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(9)
        font.setBold(False)
        font.setItalic(False)
        font.setWeight(50)
        self.Baudrate.setFont(font)
        self.Baudrate.setObjectName("Baudrate")
        self.Port = QtWidgets.QLabel(self.Terminal)
        self.Port.setGeometry(QtCore.QRect(10, 80, 55, 16))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(9)
        font.setBold(False)
        font.setItalic(False)
        font.setWeight(50)
        self.Port.setFont(font)
        self.Port.setObjectName("Port")
        self.Portbox = QtWidgets.QComboBox(self.Terminal)
        self.Portbox.setGeometry(QtCore.QRect(10, 100, 101, 22))
        self.Portbox.setObjectName("Portbox")
        self.Connect = QtWidgets.QPushButton(self.Terminal)
        self.Connect.setGeometry(QtCore.QRect(210, 70, 101, 31))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(9)
        font.setBold(False)
        font.setItalic(False)
        font.setWeight(50)
        self.Connect.setFont(font)
        self.Connect.setObjectName("Connect")
        self.Disconnect = QtWidgets.QPushButton(self.Terminal)
        self.Disconnect.setGeometry(QtCore.QRect(210, 110, 101, 31))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(9)
        font.setBold(False)
        font.setItalic(False)
        font.setWeight(50)
        self.Disconnect.setFont(font)
        self.Disconnect.setObjectName("Disconnect")
        self.Scan = QtWidgets.QPushButton(self.Terminal)
        self.Scan.setGeometry(QtCore.QRect(210, 30, 101, 31))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(9)
        font.setBold(False)
        font.setItalic(False)
        font.setWeight(50)
        self.Scan.setFont(font)
        self.Scan.setObjectName("Scan")
        self.label1 = QtWidgets.QLabel(self.Terminal)
        self.label1.setGeometry(QtCore.QRect(10, 130, 191, 16))
        self.label1.setObjectName("label1")
        self.status = QtWidgets.QLabel(self.Terminal)
        self.status.setGeometry(QtCore.QRect(10, 155, 301, 21))
        self.status.setText("")
        self.status.setObjectName("status")
        self.PID = QtWidgets.QGroupBox(self.centralwidget)
        self.PID.setGeometry(QtCore.QRect(10, 210, 321, 231))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(8)
        font.setBold(False)
        font.setItalic(False)
        font.setWeight(50)
        font.setStrikeOut(False)
        font.setKerning(True)
        self.PID.setFont(font)
        self.PID.setObjectName("PID")
        self.Kpline = QtWidgets.QLineEdit(self.PID)
        self.Kpline.setGeometry(QtCore.QRect(60, 50, 111, 22))
        self.Kpline.setObjectName("Kpline")
        self.Kpline.setAlignment(Qt.AlignCenter)
        self.Kpline.setPlaceholderText("0")
        self.Kiline = QtWidgets.QLineEdit(self.PID)
        self.Kiline.setGeometry(QtCore.QRect(60, 90, 111, 22))
        self.Kiline.setObjectName("Kiline")
        self.Kiline.setAlignment(Qt.AlignCenter)
        self.Kiline.setPlaceholderText("0")
        self.Kdline = QtWidgets.QLineEdit(self.PID)
        self.Kdline.setGeometry(QtCore.QRect(60, 130, 111, 22))
        self.Kdline.setObjectName("Kdline")
        self.Kdline.setPlaceholderText("0")
        self.Kdline.setAlignment(Qt.AlignCenter)
        self.Kp = QtWidgets.QLabel(self.PID)
        self.Kp.setGeometry(QtCore.QRect(20, 50, 55, 21))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(9)
        font.setBold(False)
        font.setItalic(False)
        font.setWeight(50)
        font.setStrikeOut(False)
        font.setKerning(True)
        self.Kp.setFont(font)
        self.Kp.setObjectName("Kp")
        self.Ki = QtWidgets.QLabel(self.PID)
        self.Ki.setGeometry(QtCore.QRect(20, 90, 55, 16))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(9)
        font.setBold(False)
        font.setItalic(False)
        font.setWeight(50)
        font.setStrikeOut(False)
        font.setKerning(True)
        self.Ki.setFont(font)
        self.Ki.setObjectName("Ki")
        self.Kd = QtWidgets.QLabel(self.PID)
        self.Kd.setGeometry(QtCore.QRect(20, 130, 55, 16))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(9)
        font.setBold(False)
        font.setItalic(False)
        font.setWeight(50)
        font.setStrikeOut(False)
        font.setKerning(True)
        self.Kd.setFont(font)
        self.Kd.setObjectName("Kd")
        self.label = QtWidgets.QLabel(self.PID)
        self.label.setGeometry(QtCore.QRect(240, 20, 71, 16))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(9)
        font.setBold(False)
        font.setItalic(False)
        font.setWeight(75)
        font.setStrikeOut(False)
        font.setKerning(True)
        font.setStyleStrategy(QtGui.QFont.PreferAntialias)
        self.label.setFont(font)
        self.label.setObjectName("label")
        self.Kpline_2 = QtWidgets.QLineEdit(self.PID)
        self.Kpline_2.setGeometry(QtCore.QRect(240, 50, 61, 22))
        self.Kpline_2.setObjectName("Kpline_2")
        self.Kpline_2.setAlignment(Qt.AlignCenter)
        self.Kpline_2.setReadOnly(True)
        self.Kiline_2 = QtWidgets.QLineEdit(self.PID)
        self.Kiline_2.setGeometry(QtCore.QRect(240, 90, 61, 22))
        self.Kiline_2.setObjectName("Kiline_2")
        self.Kiline_2.setAlignment(Qt.AlignCenter)
        self.Kiline_2.setReadOnly(True)
        self.Kdline_2 = QtWidgets.QLineEdit(self.PID)
        self.Kdline_2.setGeometry(QtCore.QRect(240, 130, 61, 22))
        self.Kdline_2.setObjectName("Kdline_2")
        self.Kdline_2.setAlignment(Qt.AlignCenter)
        self.Kdline_2.setReadOnly(True)
        self.Send = QtWidgets.QPushButton(self.PID)
        self.Send.setGeometry(QtCore.QRect(20, 170, 281, 41))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(9)
        font.setBold(False)
        font.setItalic(False)
        font.setWeight(50)
        font.setStrikeOut(False)
        font.setKerning(True)
        self.Send.setFont(font)
        self.Send.setObjectName("Send")
        self.Controller = QtWidgets.QGroupBox(self.centralwidget)
        self.Controller.setGeometry(QtCore.QRect(10, 450, 321, 141))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(8)
        font.setBold(False)
        font.setItalic(False)
        font.setWeight(50)
        font.setStyleStrategy(QtGui.QFont.PreferDefault)
        self.Controller.setFont(font)
        self.Controller.setLayoutDirection(QtCore.Qt.LeftToRight)
        self.Controller.setAlignment(QtCore.Qt.AlignLeading | QtCore.Qt.AlignLeft | QtCore.Qt.AlignVCenter)
        self.Controller.setFlat(False)
        self.Controller.setCheckable(False)
        self.Controller.setObjectName("Controller")
        self.LEFT = QtWidgets.QPushButton(self.Controller)
        self.LEFT.setGeometry(QtCore.QRect(70, 80, 51, 51))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(13)
        font.setBold(False)
        font.setItalic(False)
        font.setWeight(50)
        font.setStyleStrategy(QtGui.QFont.PreferAntialias)
        self.LEFT.setFont(font)
        self.LEFT.setCursor(QtGui.QCursor(QtCore.Qt.ArrowCursor))
        self.LEFT.setObjectName("LEFT")
        self.BACKWARD = QtWidgets.QPushButton(self.Controller)
        self.BACKWARD.setGeometry(QtCore.QRect(130, 80, 51, 51))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(8)
        font.setBold(False)
        font.setItalic(False)
        font.setWeight(50)
        font.setStyleStrategy(QtGui.QFont.PreferDefault)
        self.BACKWARD.setFont(font)
        self.BACKWARD.setCursor(QtGui.QCursor(QtCore.Qt.ArrowCursor))
        self.BACKWARD.setObjectName("BACKWARD")
        self.RIGHT = QtWidgets.QPushButton(self.Controller)
        self.RIGHT.setGeometry(QtCore.QRect(190, 80, 51, 51))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(13)
        font.setBold(False)
        font.setItalic(False)
        font.setUnderline(False)
        font.setWeight(50)
        font.setStrikeOut(False)
        font.setKerning(True)
        font.setStyleStrategy(QtGui.QFont.PreferAntialias)
        self.RIGHT.setFont(font)
        self.RIGHT.setCursor(QtGui.QCursor(QtCore.Qt.ArrowCursor))
        self.RIGHT.setObjectName("RIGHT")
        self.FORWARD = QtWidgets.QPushButton(self.Controller)
        self.FORWARD.setGeometry(QtCore.QRect(130, 20, 51, 51))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(8)
        font.setBold(False)
        font.setItalic(False)
        font.setWeight(50)
        font.setStyleStrategy(QtGui.QFont.PreferDefault)
        self.FORWARD.setFont(font)
        self.FORWARD.setCursor(QtGui.QCursor(QtCore.Qt.ArrowCursor))
        self.FORWARD.setObjectName("FORWARD")
        self.widget = QtWidgets.QWidget(self.centralwidget)
        self.widget.setGeometry(QtCore.QRect(340, 20, 731, 571))
        self.widget.setMinimumSize(QtCore.QSize(731, 571))
        self.widget.setMaximumSize(QtCore.QSize(731, 571))
        self.widget_layout = QVBoxLayout(self.widget)
        self.widget.setLayout(self.widget_layout)
        self.widget.setObjectName("widget")
        self.groupBox = QtWidgets.QGroupBox(self.centralwidget)
        self.groupBox.setGeometry(QtCore.QRect(10, 600, 1061, 231))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(8)
        self.groupBox.setFont(font)
        self.groupBox.setObjectName("groupBox")
        self.message = QtWidgets.QLineEdit(self.groupBox)
        self.message.setGeometry(QtCore.QRect(10, 30, 861, 31))
        self.message.setMinimumSize(QtCore.QSize(0, 31))
        self.message.setMaximumSize(QtCore.QSize(1041, 31))
        self.message.setObjectName("message")
        self.SerialMonitor = QtWidgets.QPlainTextEdit(self.groupBox)
        self.SerialMonitor.setGeometry(QtCore.QRect(10, 70, 1041, 151))
        self.SerialMonitor.setMinimumSize(QtCore.QSize(1041, 151))
        self.SerialMonitor.setMaximumSize(QtCore.QSize(1041, 151))
        self.SerialMonitor.setObjectName("SerialMonitor")
        self.SerialMonitor.setReadOnly(True)
        self.Clear = QtWidgets.QPushButton(self.groupBox)
        self.Clear.setGeometry(QtCore.QRect(880, 30, 171, 31))
        self.Clear.setObjectName("Clear")
        MainWindow.setCentralWidget(self.centralwidget)
        self.actionNew = QtWidgets.QAction(MainWindow)
        self.actionNew.setObjectName("actionNew")
        self.actionSave = QtWidgets.QAction(MainWindow)
        self.actionSave.setObjectName("actionSave")
        self.actionCopy = QtWidgets.QAction(MainWindow)
        self.actionCopy.setObjectName("actionCopy")
        self.actionPaste = QtWidgets.QAction(MainWindow)
        self.actionPaste.setObjectName("actionPaste")

        self.retranslateUi(MainWindow)
        QtCore.QMetaObject.connectSlotsByName(MainWindow)

        self.status_label = self.status  # QLabel trong UI
        self.serial_connection = None
        self.receive_thread = None
        self.is_connected = False  # Biến cờ kiểm tra kết nối

        self.angle_data = []
        self.time_data = []
        self.graph_widget = GraphWidget()  # Thêm một thuộc tính graph_widget để quản lý đối tượng GraphWidget
        self.widget.layout().addWidget(self.graph_widget)

        self.Scan.clicked.connect(self.scan_ports)
        self.Connect.clicked.connect(self.connect_port)
        self.Disconnect.clicked.connect(self.disconnect_port)
        self.Send.clicked.connect(self.send_parameters)
        self.Clear.clicked.connect(self.clear_output)
        self.message.returnPressed.connect(self.send_command)
        self.update_timer = QTimer(MainWindow)
        self.update_timer.timeout.connect(self.graph_widget.update_plot)
        self.update_timer.start(1000)

    def retranslateUi(self, MainWindow):
        _translate = QtCore.QCoreApplication.translate
        MainWindow.setWindowTitle(_translate("MainWindow", "Arduino Self-Balancing Robot Controller"))
        self.Terminal.setTitle(_translate("MainWindow", "Terminal"))
        self.Bdbox.setItemText(0, _translate("MainWindow", "200"))
        self.Bdbox.setItemText(1, _translate("MainWindow", "2400"))
        self.Bdbox.setItemText(2, _translate("MainWindow", "4800"))
        self.Bdbox.setItemText(3, _translate("MainWindow", "9600"))
        self.Bdbox.setItemText(4, _translate("MainWindow", "19200"))
        self.Bdbox.setItemText(5, _translate("MainWindow", "38400"))
        self.Bdbox.setItemText(6, _translate("MainWindow", "57600"))
        self.Bdbox.setItemText(7, _translate("MainWindow", "115200"))
        self.Bdbox.setCurrentIndex(3)
        self.Baudrate.setText(_translate("MainWindow", "Baudrate"))
        self.Port.setText(_translate("MainWindow", "Port"))
        self.Connect.setText(_translate("MainWindow", "Connect"))
        self.Disconnect.setText(_translate("MainWindow", "Disconnect"))
        self.Scan.setText(_translate("MainWindow", "Scan"))
        self.label1.setText(_translate("MainWindow", "Status:"))
        self.PID.setTitle(_translate("MainWindow", "PID "))
        self.Kp.setText(_translate("MainWindow", "Kp"))
        self.Ki.setText(_translate("MainWindow", "Ki"))
        self.Kd.setText(_translate("MainWindow", "Kd"))
        self.label.setText(_translate("MainWindow", "Current"))
        self.Send.setText(_translate("MainWindow", "Send"))
        self.Controller.setTitle(_translate("MainWindow", "Controller"))
        self.LEFT.setText(_translate("MainWindow", "◀"))
        self.LEFT.setShortcut(_translate("MainWindow", "Left"))
        self.BACKWARD.setText(_translate("MainWindow", "▼"))
        self.BACKWARD.setShortcut(_translate("MainWindow", "Down"))
        self.RIGHT.setText(_translate("MainWindow", "▶"))
        self.RIGHT.setShortcut(_translate("MainWindow", "Right"))
        self.FORWARD.setText(_translate("MainWindow", "▲"))
        self.FORWARD.setShortcut(_translate("MainWindow", "Up"))
        self.groupBox.setTitle(_translate("MainWindow", "Command"))
        self.message.setPlaceholderText(_translate("MainWindow", "Message (Enter to send message to Arduino)"))
        self.Clear.setText(_translate("MainWindow", "Clear Output"))
        self.actionNew.setText(_translate("MainWindow", "New"))
        self.actionSave.setText(_translate("MainWindow", "Save"))
        self.actionSave.setStatusTip(_translate("MainWindow", "Save file"))
        self.actionSave.setShortcut(_translate("MainWindow", "Ctrl+S"))
        self.actionCopy.setText(_translate("MainWindow", "Copy"))
        self.actionPaste.setText(_translate("MainWindow", "Paste"))

    def scan_ports(self):
        self.Portbox.clear()
        available_ports = list(serial.tools.list_ports.comports())
        for port in available_ports:
            self.Portbox.addItem(port.device)
        self.status_label.setText("Đã quét xong các cổng COM.")

    def connect_port(self):
        selected_port = self.Portbox.currentText()
        self.port = selected_port
        if selected_port:
            self.status_label.setText(f"Đang kết nối đến {selected_port}...")
            self.serial_thread = threading.Thread(target=self.connect_thread, args=(selected_port,))
            self.serial_thread.daemon = True
            self.serial_thread.start()
        else:
            self.status_label.setText("Chưa chọn cổng COM.")

    def connect_thread(self, selected_port):
        baudrate = int(self.Bdbox.currentText())
        self.bd = baudrate
        try:
            self.serial_connection = serial.Serial(selected_port, baudrate)
            self.is_connected = True  # Đã kết nối thành công
            self.status_label.setText(f"Kết nối đến {selected_port} thành công, baudrate {baudrate}.")
            self.Connect.setEnabled(False)

        except serial.SerialException:
            self.is_connected = False
            self.status_label.setText(f"Kết nối đến {selected_port} thất bại.")

    def disconnect_port(self):
        if self.serial_connection is not None and self.serial_connection.is_open:
            self.serial_connection.close()
            self.status_label.setText("Ngắt kết nối.")
            self.is_connected = False
            self.Connect.setEnabled(True)
            self.Kpline_2.clear()
            self.Kiline_2.clear()
            self.Kdline_2.clear()
        else:
            self.status_label.setText("Không có kết nối cổng COM nào đang mở.")

    def send_parameters(self):
        if self.is_connected is True:  # Kiểm tra kết nối trước khi gửi lệnh
            k_p = self.Kpline.text()
            k_i = self.Kiline.text()
            k_d = self.Kdline.text()

            try:
                # Cập nhật các biến Kp, Ki và Kd từ các QLineEdit
                self.Kp = float(k_p)
                self.Ki = float(k_i)
                self.Kd = float(k_d)

                if self.serial_connection is not None and self.serial_connection.is_open:
                    self.serial_connection.write(f"{self.Kp},{self.Ki},{self.Kd}\n".encode())
                    self.status_label.setText(f"Đã gửi đến {self.port} : Kp={self.Kp}, Ki={self.Ki}, Kd={self.Kd}")
                    self.SerialMonitor.appendPlainText(f"Command: Kp={self.Kp}, Ki={self.Ki}, Kd={self.Kd}")
                    self.Kpline_2.setText(k_p)
                    self.Kiline_2.setText(k_i)
                    self.Kdline_2.setText(k_d)
                else:
                    self.status_label.setText("Chưa kết nối với cổng COM.")
            except ValueError:
                self.status_label.setText("Lỗi: Vui lòng nhập giá trị số hợp lệ cho Kp, Ki và Kd.")
        else:
            self.status_label.setText("Chưa kết nối với cổng COM.")

    def send_command(self):
        command = self.message.text()
        if self.serial_connection and self.serial_connection.is_open:
            self.serial_connection.write(command.encode() + b'\n')
            self.SerialMonitor.appendPlainText(f"Command: {command}")
            self.message.clear()  # Xóa nội dung trong QLineEdit sau khi gửi lệnh

    def clear_output(self):
        self.SerialMonitor.clear()

class GraphWidget(QWidget):
    def __init__(self):
        super().__init__()
        self.angle_data = []
        self.time_data = []

        # Tạo một đối tượng Figure của Matplotlib
        canvas = FigureCanvas(Figure(figsize=(1,1)))
        layout = QVBoxLayout()
        layout.addWidget(canvas)
        self.setLayout(layout)
        self.ax = canvas.figure.subplots()
        self.ax.set_title("Góc nghiêng Theo Thời Gian")
        self.ax.set_xlabel("Thời Gian")
        self.ax.set_ylabel("Góc Nghiêng (độ)")
        t = np.linspace(0, 10, 101)
        # Set up a Line2D.
        self._line, = self.ax.plot(t, np.sin(t + time.time()))
        self._timer = canvas.new_timer(50)
        self._timer.add_callback(self.update_plot)
        self._timer.start()

    def update_plot(self):
        t = np.linspace(0, 10, 101)
        # Shift the sinusoid as a function of time.
        self._line.set_data(t, np.sin(t + time.time()))
        self._line.figure.canvas.draw()

if __name__ == "__main__":
    import sys
    app = QtWidgets.QApplication(sys.argv)
    MainWindow = QtWidgets.QMainWindow()
    ui = Ui_MainWindow()
    ui.setupUi(MainWindow)
    MainWindow.show()
    sys.exit(app.exec_())
